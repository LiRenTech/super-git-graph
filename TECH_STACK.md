# 技术栈方案 (Technical Stack Proposal)

基于项目需求（无限二维平面、节点拖拽、自定义布局、Git 可视化），以下是推荐的技术栈方案。该方案旨在兼顾**开发效率**、**性能**以及**交互体验**。

## 🚀 核心技术栈概览

| 模块 | 推荐库/工具 | 理由 |
| :--- | :--- | :--- |
| **核心框架** | **Tauri v2** + **React 19** | 项目已选定。Tauri 提供高性能原生体验，React 19 提供最新 UI 能力。 |
| **图/画布引擎** | **@xyflow/react** (原 React Flow) | **核心组件**。专为节点编辑器设计，完美支持无限画布、缩放、拖拽、自定义节点。 |
| **UI 组件库** | **shadcn/ui** + **Tailwind CSS** | 现代、轻量、高度可定制。适合构建类似 IDE 的专业工具界面。 |
| **状态管理** | **Zustand** | 轻量级，API 简洁，非常适合管理复杂的全局状态（如当前 Git 数据、布局配置）。 |
| **Git 操作 (后端)** | **Rust `git2`** | `libgit2` 的 Rust 绑定。比直接调用 git 命令行更快、更稳定，能直接读取 Git 对象数据库。 |
| **图布局算法** | **@dagrejs/dagre** | 用于计算 Git 提交图的初始布局（DAG 有向无环图），自动排列节点位置。 |
| **图标库** | **Lucide React** | 风格统一，与 shadcn/ui 完美配合。 |
| **持久化存储** | **tauri-plugin-store** | 用于保存用户的自定义布局、最近打开的项目等配置。 |

---

## 💡 详细分析与选型理由

### 1. 图形与交互引擎：@xyflow/react (React Flow)
这是实现项目核心功能的关键库。
*   **无限画布 & 交互**: 自带视口控制（缩放 Zoom、平移 Pan）、节点拖拽、框选（Selection）等功能，完全符合 README 中的操作要求。
*   **自定义节点**: Git 的提交节点（Commit Node）比较复杂（包含哈希、作者、时间、分支标签、Stash 标记等），React Flow 允许用标准的 React 组件来渲染节点，开发体验极佳。
*   **性能**: 对于 Git Graph 这种可能有成百上千个节点的场景，它有较好的优化，且支持“懒加载”机制（只渲染视口内的节点）。
*   **边（Edges）**: 支持自定义连线，可以轻松实现 Git 分支的合并/分叉线条效果。

### 2. UI 组件与样式：shadcn/ui + Tailwind CSS
*   **专业感**: 适合构建干净、紧凑、类似 VS Code 的界面风格。
*   **灵活性**: 直接复制源码到项目中，可随意修改组件逻辑（比如右键菜单 Context Menu 的样式）。
*   **暗黑模式**: 完美支持，Git 工具通常需要深色主题。

### 3. 后端 Git 处理：Rust `git2` Crate
*   **性能**: 直接操作 `.git` 文件夹的二进制数据，解析 Commit Log 速度极快。
*   **功能**: 相比调用 `git log` 命令行解析字符串，`git2` 能更方便地获取结构化数据（如父节点哈希、Tree 对象、Blob 内容等）。
*   **安全性**: 避免了命令行注入风险，也不依赖用户系统是否安装了特定版本的 Git。

### 4. 自动布局算法：dagre
*   Git 历史本质上是一个**有向无环图 (DAG)**。
*   虽然用户可以自定义拖拽，但初始加载时，需要一个算法把节点漂亮地排好（通常是按时间轴从左到右，或从下到上）。`dagre` 是处理此类布局的行业标准库。

### 5. 状态管理：Zustand
*   需要管理的数据包括：`nodes`（节点位置信息）、`edges`（连线信息）、`repoPath`（当前仓库路径）、`viewport`（当前视野位置）。
*   Zustand 比 Redux 简单得多，且性能优异（基于 selector 避免不必要的重渲染），非常适合高频交互场景。

## 🛠️ 建议的开发路线

1.  **初始化 UI**: 安装 Tailwind CSS 和 shadcn/ui，搭建基本的 Layout（侧边栏/顶部栏 + 主画布区域）。
2.  **Rust 后端**: 在 `src-tauri` 中引入 `git2`，编写一个命令 `get_commits(path, limit)`，返回结构化的 Commit JSON 数据。
3.  **前端集成 React Flow**:
    *   定义 `CommitNode` 自定义组件（显示哈希、信息、分支标签）。
    *   使用 `dagre` 计算初始节点位置 $(x, y)$。
    *   将 Rust 返回的数据转换为 React Flow 的 `nodes` 和 `edges`。
4.  **实现懒加载**:
    *   监听 React Flow 的 `onMoveEnd` 或视口变化事件。
    *   当视口接近边缘或用户点击“加载更多”节点时，调用 Rust 接口获取更早的提交。
5.  **持久化**:
    *   当用户拖拽节点结束 (`onNodeDragStop`)，更新 Zustand store。
    *   在应用关闭或定期将节点位置信息保存到本地 JSON 文件（通过 `tauri-plugin-store`）。
